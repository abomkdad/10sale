<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>MAD Perfumeur – Landing</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{background:#0b0f19;color:#fff}
    .no-scrollbar::-webkit-scrollbar{display:none}
    .no-scrollbar{-ms-overflow-style:none;scrollbar-width:none}
    .full-bleed{width:100vw;max-width:100vw;margin-left:calc(50% - 50vw);margin-right:calc(50% - 50vw)}
    img{-webkit-user-drag:none;user-select:none;display:block}
    .card-selected{border-color:rgb(245 158 11); box-shadow:0 0 0 2px rgb(245 158 11 / 0.35)}
    .check-badge{position:absolute; top:.4rem; inset-inline-end:.4rem; background:rgb(245 158 11); color:#111827; font-weight:700; font-size:.7rem; padding:.15rem .4rem; border-radius:.5rem}
  </style>
</head>
<body class="min-h-screen overflow-x-hidden">
  <div id="app" class="mx-auto w-full max-w-sm px-3 pb-28">

    <!-- HEADER -->
    <header class="sticky top-0 z-30 backdrop-blur bg-[#0e1424]/80 border-b border-slate-800">
      <div class="flex items-center gap-3 p-3">
        <img src="img/logo.png" onerror="this.style.display='none'" alt="logo" class="h-8 w-8 rounded-full ring-2 ring-amber-500">
        <div class="flex-1 leading-tight">
          <h1 id="t_title" class="text-sm font-semibold">...</h1>
          <p class="text-[11px] text-slate-400">MAD Perfumeur</p>
        </div>
        <a id="callWa" href="#" class="text-amber-400 text-sm">WhatsApp</a>
      </div>
    </header>

    <!-- HERO (الصورة المختارة) -->
    <section class="mt-3">
      <div class="rounded-2xl overflow-hidden border border-slate-800 bg-slate-900">
        <img id="heroImg" src="img/p1.png" alt="المنتج المختار" class="w-full h-auto">
      </div>
      <div id="selectedPill" class="mt-2 hidden text-[12px] text-emerald-300">✓ تم اختيار مجموعة</div>
    </section>

    <!-- CAROUSEL -->
    <section class="mt-3">
      <div id="carousel" class="flex gap-3 overflow-x-auto snap-x snap-mandatory no-scrollbar px-1 pb-1"></div>
      <p id="t_choose" class="text-center text-[12px] text-slate-400 mt-2">اختر المجموعة</p>
    </section>

    <!-- ORDER (حقول فقط) -->
    <section class="mt-2">
      <div class="rounded-2xl border border-slate-800 bg-slate-900/60">
        <form id="orderForm" class="p-3 space-y-3">
          <div>
            <label id="t_name" class="text-[11px] text-slate-400">الاسم الكامل</label>
            <input id="name" required class="mt-1 w-full rounded-xl bg-slate-800 border border-slate-700 p-2 text-sm"/>
          </div>
          <div>
            <label id="t_phone" class="text-[11px] text-slate-400">رقم الهاتف</label>
            <input id="phone" required class="mt-1 w-full rounded-xl bg-slate-800 border border-slate-700 p-2 text-sm"/>
          </div>
          <div>
            <label id="t_city" class="text-[11px] text-slate-400">البلد / العنوان</label>
            <input id="city" required class="mt-1 w-full rounded-xl bg-slate-800 border border-slate-700 p-2 text-sm"/>
          </div>
          <div>
            <label id="t_notes" class="text-[11px] text-slate-400">ملاحظات (اختياري)</label>
            <textarea id="notes" rows="2" class="mt-1 w-full rounded-xl bg-slate-800 border border-slate-700 p-2 text-sm"></textarea>
          </div>

          <div class="flex items-start gap-2 text-xs text-slate-300">
            <input id="agree" type="checkbox" class="mt-1">
            <label id="t_confirm" for="agree" class="leading-snug">...</label>
          </div>

          <div class="flex gap-2">
            <button id="sendBtn" type="submit" class="flex-1 inline-flex items-center justify-center gap-2 rounded-2xl py-3 text-sm font-semibold bg-amber-500 text-slate-900 hover:bg-amber-400 disabled:opacity-60 disabled:cursor-not-allowed">
              <span id="t_send">إرسال الطلب عبر واتساب</span>
            </button>
            <button id="previewBtn" type="button" class="px-3 rounded-2xl border border-slate-700 bg-slate-800 text-sm">
              <span id="t_preview">معاينة</span>
            </button>
          </div>
        </form>
      </div>
    </section>

    <!-- ABOUT (full-bleed) -->
    <section class="mt-4">
      <img id="aboutImg" src="" alt="About / על החברה" class="full-bleed block h-auto" loading="lazy" decoding="async">
      <p id="aboutStatus" class="text-center text-[12px] text-red-300 mt-1"></p>
    </section>

    <!-- STICKY CTA -->
    <div class="fixed bottom-2 inset-x-3 z-30">
      <a href="#" id="ctaTop" class="block w-full text-center rounded-2xl py-3 bg-gradient-to-r from-amber-400 to-amber-500 text-slate-900 font-bold shadow-lg">
        <span id="t_orderNow">اطلب الآن</span>
      </a>
    </div>
  </div>

  <!-- PREVIEW MODAL -->
  <div id="modal" class="hidden fixed inset-0 z-50 bg-black/70 items-center justify-center p-3">
    <div class="w-full max-w-sm rounded-2xl bg-slate-900 border border-slate-800 overflow-hidden">
      <div class="flex items-center justify-between p-3 border-b border-slate-800">
        <p id="t_previewTitle" class="text-sm font-semibold">معاينة</p>
        <button id="closeModal" class="p-1 rounded-lg bg-slate-800 border border-slate-700">✕</button>
      </div>
      <div class="p-3 space-y-3">
        <div class="rounded-2xl overflow-hidden border border-slate-800">
          <img id="prevImg" src="img/p1.png" class="w-full h-auto">
        </div>
        <div class="text-xs text-slate-200 space-y-1">
          <div><b id="t_prevName">الاسم:</b> <span id="prevName">—</span></div>
          <div><b id="t_prevPhone">الهاتف:</b> <span id="prevPhone">—</span></div>
          <div><b id="t_prevAddr">العنوان:</b> <span id="prevAddr">—</span></div>
          <div id="prevNotesWrap" class="hidden"><b id="t_prevNotes">ملاحظات:</b> <span id="prevNotes">—</span></div>
        </div>
        <div class="flex gap-2">
          <button id="sendFromPreview" class="flex-1 inline-flex items-center justify-center gap-2 rounded-xl bg-amber-500 text-slate-900 py-2 text-sm font-semibold">
            <span id="t_sendNow">إرسال الطلب الآن</span>
          </button>
          <a id="downloadPromo" class="hidden flex-1 inline-flex items-center justify-center gap-2 rounded-xl bg-slate-800 border border-slate-700 py-2 text-sm">
            <span id="t_download">تنزيل الصورة</span>
          </a>
        </div>
      </div>
    </div>
  </div>

<script>
/*** CONFIG ***/
let WHATSAPP_NUMBER = "972525105889"; // غيّره عند الحاجة (بدون +)
const PRODUCTS = [
  { id:"Q106", name:"باقة 3 عطور – كلاسيك", img:"img/p1.png" },
  { id:"Q110", name:"باقة 5 عطور – جولد",   img:"img/p2.png" },
  { id:"T109", name:"Ombre Style",          img:"img/p3.png" },
  { id:"A118", name:"Aventus Style",        img:"img/p4.png" },
  { id:"C120", name:"Coco Style",           img:"img/p5.png" },
  { id:"R130", name:"Rose Oud",             img:"img/p6.png" },
  { id:"N101", name:"Neroli",               img:"img/p7.png" },
  { id:"S205", name:"Santal",               img:"img/p8.png" },
  { id:"M501", name:"Musk",                 img:"img/p9.png" },
  { id:"H777", name:"Hair Mist Set",        img:"img/p10.png"}
];

/*** I18N ***/
const STR = {
  ar: { title:"عطور مختارة – اطلب الآن عبر واتساب", choose:"اختر المجموعة", selected:"✓ تم اختيار مجموعة",
        name:"الاسم الكامل", phone:"رقم الهاتف", city:"البلد / العنوان", notes:"ملاحظات (اختياري)",
        confirm:"أؤكد أن هذا النموذج خاص بالطلب فقط وليس للاستفسارات، وأوافق على إتمام الطلب وفق التفاصيل.",
        send:"إرسال الطلب عبر واتساب", preview:"معاينة", orderNow:"اطلب الآن", previewTitle:"معاينة",
        prevName:"الاسم:", prevPhone:"الهاتف:", prevAddr:"العنوان:", prevNotes:"ملاحظات:", sendNow:"إرسال الطلب الآن", download:"تنزيل الصورة" },
  he: { title:"בשמים נבחרים – הזמנה בווטסאפ", choose:"בחרו קבוצה", selected:"✓ נבחרה חבילה",
        name:"שם מלא", phone:"מספר טלפון", city:"עיר / כתובת", notes:"הערות (אופציונלי)",
        confirm:"אני מאשר/ת שטופס זה מיועד להזמנה בלבד ולא לפניות כלליות, ומסכים/ה להשלים את ההזמנה לפי הפרטים.",
        send:"שליחת ההזמנה בווטסאפ", preview:"תצוגה מקדימה", orderNow:"הזמנה עכשיו", previewTitle:"תצוגה מקדימה",
        prevName:"שם:", prevPhone:"טלפון:", prevAddr:"כתובת:", prevNotes:"הערות:", sendNow:"שלח/י הזמנה עכשיו", download:"הורד/י תמונה" }
};
function detectLang(){
  const qs=new URLSearchParams(location.search);
  const q=qs.get('lang');
  if(q==='ar'||q==='he') return q;
  const nav=(navigator.languages&&navigator.languages[0])||navigator.language||'ar';
  if(/^he\b/i.test(nav)) return 'he';
  if(/^ar\b/i.test(nav)) return 'ar';
  return 'ar';
}
let LANG = 'ar'; // default safe

/*** SAFE GETTER ***/
const G = id => document.getElementById(id);

/*** Elements ***/
const els = {
  callWa:G('callWa'),
  hero:G('heroImg'),
  selectedPill:G('selectedPill'),
  carousel:G('carousel'),
  name:G('name'),
  phone:G('phone'),
  city:G('city'),
  notes:G('notes'),
  agree:G('agree'),
  form:G('orderForm'),
  previewBtn:G('previewBtn'),
  ctaTop:G('ctaTop'),
  modal:G('modal'),
  closeModal:G('closeModal'),
  prevImg:G('prevImg'),
  prevName:G('prevName'),
  prevPhone:G('prevPhone'),
  prevAddr:G('prevAddr'),
  prevNotesWrap:G('prevNotesWrap'),
  prevNotes:G('prevNotes'),
  sendFromPreview:G('sendFromPreview'),
  downloadPromo:G('downloadPromo'),
  aboutImg:G('aboutImg'),
  aboutStatus:G('aboutStatus'),
  // labels
  t:{
    title:G('t_title'), choose:G('t_choose'), orderNow:G('t_orderNow'), previewTitle:G('t_previewTitle'),
    name:G('t_name'), phone:G('t_phone'), city:G('t_city'), notes:G('t_notes'),
    confirm:G('t_confirm'), send:G('t_send'), preview:G('t_preview'),
    prevName:G('t_prevName'), prevPhone:G('t_prevPhone'), prevAddr:G('t_prevAddr'), prevNotes:G('t_prevNotes'),
    sendNow:G('t_sendNow'), download:G('t_download')
  }
};

function i18n(){
  try{
    LANG = detectLang();
    const S=STR[LANG] || STR.ar;
    document.documentElement.lang = LANG==='he'?'he':'ar';
    document.documentElement.dir  = 'rtl';
    for (const [k,el] of Object.entries(els.t)) { if (el) el.textContent = S[k] ?? el.textContent; }
    if (els.selectedPill) els.selectedPill.textContent = S.selected || els.selectedPill.textContent;
  }catch(e){ console.warn('i18n failed', e); }
}

function normalizeILPhone(input){
  const d=(input||"").replace(/\D+/g,"");
  if(!d) return "";
  if(d.startsWith("972")){
    const local=d.slice(3);
    return local.startsWith("0")?local:"0"+local;
  }
  if(d.startsWith("05")) return d;
  if(d.startsWith("5")) return "0"+d;
  return d;
}

function buildText({name,phone,city,notes}){
  const S=(STR[LANG]||STR.ar);
  return (
   `🧾 MAD Perfumeur — ${LANG==='he'?'הזמנה חדשה':'طلب جديد'}\n\n`+
   `${S.prevName} ${name}\n`+
   `${S.prevPhone} ${phone}\n`+
   `${S.prevAddr} ${city}\n`+
   (notes?`${S.prevNotes} ${notes}\n\n`:"\n")+
   `${LANG==='he'?'אני מאשר/ת ביצוע הזמנה לפי הפרטים.':'أؤكد تنفيذ الطلب وفق التفاصيل.'}`
  );
}

async function fetchImageAsFile(url, name="selection.png"){
  try{
    const r=await fetch(url,{mode:"cors"});
    const b=await r.blob();
    return new File([b], name, {type:b.type || "image/png"});
  }catch(e){ console.warn('image fetch failed', e); return null; }
}

/*** STATE + RENDER ***/
let selectedIndex = 0;
let selected = PRODUCTS[selectedIndex];

function markSelectedCard(){
  [...els.carousel.querySelectorAll('.card')].forEach(c=>{
    c.classList.remove('card-selected');
    const b = c.querySelector('.check-badge'); if(b) b.remove();
  });
  const card = els.carousel.querySelector(`[data-idx="${selectedIndex}"]`);
  if(card){
    card.classList.add('card-selected');
    const badge = document.createElement('div');
    badge.className='check-badge'; badge.textContent='✓';
    const wrap = card.querySelector('.imgwrap')||card; wrap.appendChild(badge);
  }
  if (els.selectedPill) els.selectedPill.classList.remove('hidden');
}

function renderSelected(){
  if (els.hero) els.hero.src = selected.img;
  markSelectedCard();
}

function renderCarousel(){
  if (!els.carousel) return;
  els.carousel.innerHTML="";
  PRODUCTS.forEach((p,idx)=>{
    const btn=document.createElement('button');
    btn.type='button';
    btn.setAttribute('data-idx', idx);
    btn.className="card snap-start shrink-0 w-44 rounded-2xl p-2 bg-slate-900 border border-slate-800";
    btn.innerHTML = `
      <div class="imgwrap relative overflow-hidden rounded-xl bg-slate-800">
        <img src="${p.img}" alt="" class="w-full h-auto">
      </div>
    `;
    btn.addEventListener('click', ()=>{
      selectedIndex = idx; selected = PRODUCTS[selectedIndex];
      renderSelected();
      document.getElementById('app').scrollTo({top:0,behavior:'smooth'});
    });
    els.carousel.appendChild(btn);
  });
}

/*** AUTO CAROUSEL SCROLL ***/
let autoTimer = null, autoIdx = 0, resumeTimeout = null;

function startAutoCarousel(){
  stopAutoCarousel();
  const cont = els.carousel;
  if(!cont) return;
  const items = [...cont.querySelectorAll('.card')];
  if(items.length <= 2) return; // لو العناصر قليلة ما في داعي

  // ابدأ من بداية الشريط
  autoIdx = 0;

  autoTimer = setInterval(()=>{
    autoIdx = (autoIdx + 1) % items.length;
    const target = items[autoIdx];
    const x = target.offsetLeft - 8; // هوامش بسيطة
    cont.scrollTo({ left:x, behavior:'smooth' });
  }, 1000); // كل ثانية
}

function stopAutoCarousel(){
  if(autoTimer){ clearInterval(autoTimer); autoTimer = null; }
}

function pauseAndResume(){
  stopAutoCarousel();
  clearTimeout(resumeTimeout);
  resumeTimeout = setTimeout(startAutoCarousel, 5000); // استئناف بعد 5 ثواني
}

// أوقف الأوتو عند تفاعل المستخدم
['pointerdown','wheel','touchstart','mouseenter'].forEach(ev=>{
  document.addEventListener('DOMContentLoaded', ()=>{
    els.carousel?.addEventListener(ev, pauseAndResume, {passive:true});
  });
});

// أوقف عند إخفاء التبويب وارجع شغّل عند الرجوع
document.addEventListener('visibilitychange', ()=>{
  if(document.hidden) stopAutoCarousel(); else pauseAndResume();
});

/*** PREVIEW + SEND ***/
function fillPreview(){
  if (els.prevImg) els.prevImg.src = selected.img;
  const norm = normalizeILPhone(els.phone.value);
  if (els.prevName)  els.prevName.textContent  = els.name.value || '—';
  if (els.prevPhone) els.prevPhone.textContent = norm || '—';
  if (els.prevAddr)  els.prevAddr.textContent  = els.city.value || '—';
  const n=(els.notes.value||"").trim();
  if (els.prevNotesWrap) {
    if(n){ els.prevNotesWrap.classList.remove('hidden'); if (els.prevNotes) els.prevNotes.textContent=n; }
    else { els.prevNotesWrap.classList.add('hidden'); if (els.prevNotes) els.prevNotes.textContent=""; }
  }
}

async function doSend(){
  if(!els.agree.checked){ alert((STR[LANG]||STR.ar).confirm); return; }
  const norm = normalizeILPhone(els.phone.value);
  const text = buildText({
    name: els.name.value, phone: norm, city: els.city.value, notes: (els.notes.value||"").trim()
  });

  const shareFile = await fetchImageAsFile(selected.img);
  try{
    const data = shareFile ? { files:[shareFile], text, title:'MAD Order' } : { text, title:'MAD Order' };
    if(navigator.canShare && navigator.canShare(data)){
      await navigator.share(data); return;
    }
  }catch(e){ console.warn('share failed', e); }

  window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`,"_blank");
  fillPreview();
  if (els.downloadPromo){ els.downloadPromo.classList.remove('hidden'); els.downloadPromo.href = selected.img; }
  if (els.modal){ els.modal.classList.remove('hidden'); els.modal.classList.add('flex'); }
}

/*** About BNG auto-detect ***/
function canLoad(src){
  return new Promise(res=>{
    const im=new Image();
    im.onload=()=>res(true);
    im.onerror=()=>res(false);
    im.src = src + (src.includes('?')?'&':'?') + 'v=' + Date.now();
  });
}
async function setAboutAuto(){
  if (!els.aboutImg) return;
  const status = msg => { if (els.aboutStatus) els.aboutStatus.textContent = msg||''; };

  // ?about=FileName.ext override
  try{
    const qs = new URLSearchParams(location.search);
    const aboutQS = qs.get('about');
    if (aboutQS) {
      const direct = 'img/' + decodeURIComponent(aboutQS);
      if (await canLoad(direct)) { els.aboutImg.src = direct; status(''); return; }
    }
  }catch(e){}

  // try common names first
  const primaries = ['img/About%20BNG.png','img/About%20BNG.jpg','img/About%20BNG.webp'];
  for (const p of primaries){ if (await canLoad(p)){ els.aboutImg.src=p; status(''); return; } }

  const bases = ['About BNG','ABOUT BNG','about bng','About_BNG','ABOUT_BNG','about_bng','About-BNG','ABOUT-BNG','about-bng'];
  const suffixes = ['', ' (1)',' (2)',' (3)',' (final)','_final','-final'];
  const exts = ['.png','.jpg','.jpeg','.webp','.gif','.PNG','.JPG','.JPEG','.WEBP','.GIF'];
  const encs = s => [s, s.replace(/\s/g,'%20'), s.replace(/\s/g,'+')];

  for (const base of bases) for (const suf of suffixes) for (const e of exts)
    for (const p of encs(`img/${base}${suf}${e}`))
      if (await canLoad(p)){ els.aboutImg.src=p; status(''); return; }

  // simple fallbacks
  for (const f of ['about','About','ABOUT']) for (const e of exts){
    const p=`img/${f}${e}`; if (await canLoad(p)){ els.aboutImg.src=p; status(''); return; }
  }
  status(LANG==='he' ? 'לא נמצאה תמונת About BNG בתיקיית img' : 'لم يتم العثور على صورة About BNG داخل مجلد img');
}

/*** EVENTS ***/
G('previewBtn').onclick = ()=>{ fillPreview(); els.modal.classList.remove('hidden'); els.modal.classList.add('flex'); };
G('closeModal').onclick = ()=>{ els.modal.classList.add('hidden'); els.modal.classList.remove('flex'); };
G('sendFromPreview').onclick = doSend;
G('orderForm').addEventListener('submit', (e)=>{ e.preventDefault(); doSend(); });
G('ctaTop').onclick = (e)=>{ e.preventDefault(); G('orderForm').scrollIntoView({ behavior:'smooth', block:'start' }); };

/*** INIT ***/
(function init() {
  try{
    i18n();

    // WA override via ?wa=
    const qs = new URLSearchParams(location.search);
    const wa = (qs.get('wa')||'').replace(/\D+/g,'');
    if(wa)972506164130 = wa;
    if (els.callWa) els.callWa.href = "https://wa.me/"+972506164130;

    // Carousel + selection
    renderCarousel();
    selectedIndex = 0; selected = PRODUCTS[selectedIndex];
    renderSelected();

    // Auto carousel
    startAutoCarousel();

    // About image
    setAboutAuto();
  }catch(err){
    console.error('INIT ERROR:', err);
  }
})();
</script>
</body>
</html>
