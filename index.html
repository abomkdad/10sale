<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>MAD Perfumeur â€“ Landing</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{background:#0b0f19;color:#fff}
    .no-scrollbar::-webkit-scrollbar{display:none}
    .no-scrollbar{-ms-overflow-style:none;scrollbar-width:none}
    .full-bleed{width:100vw;max-width:100vw;margin-left:calc(50% - 50vw);margin-right:calc(50% - 50vw)}
    img{-webkit-user-drag:none;user-select:none}
  </style>
</head>
<body class="min-h-screen overflow-x-hidden">
  <div id="app" class="mx-auto w-full max-w-sm px-3 pb-28">

    <!-- HEADER -->
    <header class="sticky top-0 z-30 backdrop-blur bg-[#0e1424]/80 border-b border-slate-800">
      <div class="flex items-center gap-3 p-3">
        <img src="img/logo.png" onerror="this.style.display='none'" alt="logo" class="h-8 w-8 rounded-full ring-2 ring-amber-500">
        <div class="flex-1 leading-tight">
          <h1 id="t_title" class="text-sm font-semibold">...</h1>
          <p class="text-[11px] text-slate-400">MAD Perfumeur</p>
        </div>
        <a id="callWa" href="#" class="text-amber-400 text-sm">WhatsApp</a>
      </div>
    </header>

    <!-- SELECTED IMAGE (HERO) -->
    <section class="mt-3">
      <div class="rounded-2xl overflow-hidden border border-slate-800 bg-slate-900">
        <img id="heroImg" src="img/p1.png" alt="Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø®ØªØ§Ø±" class="w-full aspect-[9/10] object-contain bg-black/20">
      </div>
    </section>

    <!-- CAROUSEL (images only) -->
    <section class="mt-3">
      <div id="carousel" class="flex gap-3 overflow-x-auto snap-x snap-mandatory no-scrollbar px-1 pb-1"></div>
      <p id="t_choose" class="text-center text-[12px] text-slate-400 mt-1">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</p>
    </section>

    <!-- ORDER CARD -->
    <section class="mt-2">
      <div class="rounded-2xl border border-slate-800 bg-slate-900/60">
        <div class="p-3 border-b border-slate-800">
          <p id="selName" class="text-sm font-semibold">â€”</p>
          <p class="text-xs text-amber-400"><span id="selPrice">â‚ª0</span> â€” <span id="t_details">Ø§Ù„ØªÙØ§ØµÙŠÙ„</span></p>
        </div>

        <form id="orderForm" class="p-3 space-y-3">
          <!-- OPTION (hidden if none / ml removed) -->
          <div id="optWrap">
            <label id="t_option" class="text-[11px] text-slate-400 block mb-1">Ø§Ù„Ø®ÙŠØ§Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <select id="option" class="w-full rounded-xl bg-slate-800 border border-slate-700 p-2 text-sm"></select>
          </div>

          <!-- Fields (NO placeholders) -->
          <div>
            <label id="t_name" class="text-[11px] text-slate-400">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
            <input id="name" required class="mt-1 w-full rounded-xl bg-slate-800 border border-slate-700 p-2 text-sm"/>
          </div>
          <div>
            <label id="t_phone" class="text-[11px] text-slate-400">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
            <input id="phone" required class="mt-1 w-full rounded-xl bg-slate-800 border border-slate-700 p-2 text-sm"/>
          </div>
          <div>
            <label id="t_city" class="text-[11px] text-slate-400">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© / Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
            <input id="city" required class="mt-1 w-full rounded-xl bg-slate-800 border border-slate-700 p-2 text-sm"/>
          </div>
          <div>
            <label id="t_notes" class="text-[11px] text-slate-400">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <textarea id="notes" rows="2" class="mt-1 w-full rounded-xl bg-slate-800 border border-slate-700 p-2 text-sm"></textarea>
          </div>

          <div class="flex items-start gap-2 text-xs text-slate-300">
            <input id="agree" type="checkbox" class="mt-1">
            <label id="t_confirm" for="agree" class="leading-snug">...</label>
          </div>

          <div class="flex gap-2">
            <button id="sendBtn" type="submit" class="flex-1 inline-flex items-center justify-center gap-2 rounded-2xl py-3 text-sm font-semibold bg-amber-500 text-slate-900 hover:bg-amber-400 disabled:opacity-60 disabled:cursor-not-allowed">
              <span id="t_send">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</span>
            </button>
            <button id="previewBtn" type="button" class="px-3 rounded-2xl border border-slate-700 bg-slate-800 text-sm">
              <span id="t_preview">Ù…Ø¹Ø§ÙŠÙ†Ø©</span>
            </button>
          </div>
        </form>
      </div>
    </section>

    <!-- ABOUT LONG IMAGE (auto-detect â€œAbout BNG.*â€) -->
    <section class="mt-4">
      <img id="aboutImg" src="" alt="About / ×¢×œ ×”×—×‘×¨×”" class="full-bleed block h-auto" loading="lazy" decoding="async">
    </section>

    <!-- STICKY CTA -->
    <div class="fixed bottom-2 inset-x-3 z-30">
      <a href="#" id="ctaTop" class="block w-full text-center rounded-2xl py-3 bg-gradient-to-r from-amber-400 to-amber-500 text-slate-900 font-bold shadow-lg">
        <span id="t_orderNow">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</span>
      </a>
    </div>
  </div>

  <!-- PREVIEW MODAL (send from here too) -->
  <div id="modal" class="hidden fixed inset-0 z-50 bg-black/70 items-center justify-center p-3">
    <div class="w-full max-w-sm rounded-2xl bg-slate-900 border border-slate-800 overflow-hidden">
      <div class="flex items-center justify-between p-3 border-b border-slate-800">
        <p id="t_previewTitle" class="text-sm font-semibold">Ù…Ø¹Ø§ÙŠÙ†Ø©</p>
        <button id="closeModal" class="p-1 rounded-lg bg-slate-800 border border-slate-700">âœ•</button>
      </div>
      <div class="p-3 space-y-3">
        <div class="rounded-2xl overflow-hidden border border-slate-800">
          <img id="prevImg" src="img/p1.png" class="w-full object-contain bg-black/20">
        </div>
        <div class="text-xs text-slate-200 space-y-1">
          <div><b id="t_prevProd">Ø§Ù„Ù…Ù†ØªØ¬:</b> <span id="prevProd">â€”</span></div>
          <div id="prevOptLine"><b id="t_prevOpt">Ø§Ù„Ø®ÙŠØ§Ø±:</b> <span id="prevOpt">â€”</span></div>
          <div><b id="t_prevPrice">Ø§Ù„Ø³Ø¹Ø±:</b> <span id="prevPrice">â‚ª0</span></div>
          <div><b id="t_prevName">Ø§Ù„Ø§Ø³Ù…:</b> <span id="prevName">â€”</span></div>
          <div><b id="t_prevPhone">Ø§Ù„Ù‡Ø§ØªÙ:</b> <span id="prevPhone">â€”</span></div>
          <div><b id="t_prevAddr">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</b> <span id="prevAddr">â€”</span></div>
          <div id="prevNotesWrap" class="hidden"><b id="t_prevNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</b> <span id="prevNotes">â€”</span></div>
        </div>
        <div class="flex gap-2">
          <button id="sendFromPreview" class="flex-1 inline-flex items-center justify-center gap-2 rounded-xl bg-amber-500 text-slate-900 py-2 text-sm font-semibold">
            <span id="t_sendNow">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</span>
          </button>
          <a id="downloadPromo" class="hidden flex-1 inline-flex items-center justify-center gap-2 rounded-xl bg-slate-800 border border-slate-700 py-2 text-sm">
            <span id="t_download">ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©</span>
          </a>
        </div>
      </div>
    </div>
  </div>

<script>
/*** CONFIG ***/
let WHATSAPP_NUMBER = "972525105889"; // ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ?wa=
const PRODUCTS = [
  { id:"Q106", name:"Ø¨Ø§Ù‚Ø© 3 Ø¹Ø·ÙˆØ± â€“ ÙƒÙ„Ø§Ø³ÙŠÙƒ", price:300, img:"img/p1.png", options:["ÙƒÙ„Ø§Ø³ÙŠÙƒ","Ù‚ÙˆÙŠ","Ù…ÙƒØ³","Ø¹Ø±Ø¨ÙŠ","ÙØ±Ù†Ø³ÙŠ"] },
  { id:"Q110", name:"Ø¨Ø§Ù‚Ø© 5 Ø¹Ø·ÙˆØ± â€“ Ø¬ÙˆÙ„Ø¯",   price:500, img:"img/p2.png", options:["Ù…ÙƒØ³","Ø¹Ø±Ø¨ÙŠ","ÙØ±Ù†Ø³ÙŠ"] },
  { id:"T109", name:"Ombre Style",          price:120, img:"img/p3.png", options:["Ø®Ø´Ø¨ÙŠ","Ø²Ù‡Ø±ÙŠ"] },
  { id:"A118", name:"Aventus Style",        price:120, img:"img/p4.png", options:["Ù‚ÙˆÙŠ","ÙƒÙ„Ø§Ø³ÙŠÙƒ"] },
  { id:"C120", name:"Coco Style",           price:120, img:"img/p5.png", options:["Ø²Ù‡Ø±ÙŠ","ÙØ§Ù†ÙŠÙ„Ø§"] },
  { id:"R130", name:"Rose Oud",             price:150, img:"img/p6.png", options:["Ø¹Ø±Ø¨ÙŠ","Ù‚ÙˆÙŠ"] },
  { id:"N101", name:"Neroli",               price:110, img:"img/p7.png", options:[] },
  { id:"S205", name:"Santal",               price:140, img:"img/p8.png", options:["ÙƒÙ„Ø§Ø³ÙŠÙƒ"] },
  { id:"M501", name:"Musk",                 price: 99, img:"img/p9.png", options:[] },
  { id:"H777", name:"Hair Mist Set",        price: 89, img:"img/p10.png",options:[] },
];

/*** I18N ***/
const STR = {
  ar: {
    title:"Ø¹Ø·ÙˆØ± Ù…Ø®ØªØ§Ø±Ø© â€“ Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨",
    details:"Ø§Ù„ØªÙØ§ØµÙŠÙ„",
    option:"Ø§Ù„Ø®ÙŠØ§Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",
    choose:"Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©",
    name:"Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„",
    phone:"Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ",
    city:"Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© / Ø§Ù„Ø¹Ù†ÙˆØ§Ù†",
    notes:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",
    confirm:"Ø£Ø¤ÙƒØ¯ Ø£Ù† Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø®Ø§Øµ Ø¨Ø§Ù„Ø·Ù„Ø¨ ÙÙ‚Ø· ÙˆÙ„ÙŠØ³ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§ØªØŒ ÙˆØ£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ ÙˆÙÙ‚ Ø§Ù„ØªÙØ§ØµÙŠÙ„.",
    send:"Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨",
    preview:"Ù…Ø¹Ø§ÙŠÙ†Ø©",
    orderNow:"Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†",
    previewTitle:"Ù…Ø¹Ø§ÙŠÙ†Ø©",
    prevProd:"Ø§Ù„Ù…Ù†ØªØ¬:",
    prevOpt:"Ø§Ù„Ø®ÙŠØ§Ø±:",
    prevPrice:"Ø§Ù„Ø³Ø¹Ø±:",
    prevName:"Ø§Ù„Ø§Ø³Ù…:",
    prevPhone:"Ø§Ù„Ù‡Ø§ØªÙ:",
    prevAddr:"Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:",
    prevNotes:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª:",
    sendNow:"Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†",
    download:"ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©",
  },
  he: {
    title:"×‘×©××™× × ×‘×—×¨×™× â€“ ×”×–×× ×” ×‘×•×•×˜×¡××¤",
    details:"×¤×¨×˜×™×",
    option:"×‘×—×™×¨×” (××•×¤×¦×™×•× ×œ×™)",
    choose:"×‘×—×¨×• ×§×‘×•×¦×”",
    name:"×©× ××œ×",
    phone:"××¡×¤×¨ ×˜×œ×¤×•×Ÿ",
    city:"×¢×™×¨ / ×›×ª×•×‘×ª",
    notes:"×”×¢×¨×•×ª (××•×¤×¦×™×•× ×œ×™)",
    confirm:"×× ×™ ×××©×¨/×ª ×©×˜×•×¤×¡ ×–×” ××™×•×¢×“ ×œ×”×–×× ×” ×‘×œ×‘×“ ×•×œ× ×œ×¤× ×™×•×ª ×›×œ×œ×™×•×ª, ×•××¡×›×™×/×” ×œ×”×©×œ×™× ××ª ×”×”×–×× ×” ×œ×¤×™ ×”×¤×¨×˜×™×.",
    send:"×©×œ×™×—×ª ×”×”×–×× ×” ×‘×•×•×˜×¡××¤",
    preview:"×ª×¦×•×’×” ××§×“×™××”",
    orderNow:"×”×–×× ×” ×¢×›×©×™×•",
    previewTitle:"×ª×¦×•×’×” ××§×“×™××”",
    prevProd:"××•×¦×¨:",
    prevOpt:"×‘×—×™×¨×”:",
    prevPrice:"××—×™×¨:",
    prevName:"×©×:",
    prevPhone:"×˜×œ×¤×•×Ÿ:",
    prevAddr:"×›×ª×•×‘×ª:",
    prevNotes:"×”×¢×¨×•×ª:",
    sendNow:"×©×œ×—/×™ ×”×–×× ×” ×¢×›×©×™×•",
    download:"×”×•×¨×“/×™ ×ª××•× ×”",
  }
};
function detectLang(){
  const qs=new URLSearchParams(location.search);
  const q=qs.get('lang');
  if(q==='ar'||q==='he') return q;
  const nav=(navigator.languages&&navigator.languages[0])||navigator.language||'ar';
  if(/^he\b/i.test(nav)) return 'he';
  if(/^ar\b/i.test(nav)) return 'ar';
  return 'ar';
}
let LANG = detectLang();

/*** Helpers ***/
const els = {
  callWa:document.getElementById('callWa'),
  hero:document.getElementById('heroImg'),
  carousel:document.getElementById('carousel'),
  selName:document.getElementById('selName'),
  selPrice:document.getElementById('selPrice'),
  optionWrap:document.getElementById('optWrap'),
  option:document.getElementById('option'),
  name:document.getElementById('name'),
  phone:document.getElementById('phone'),
  city:document.getElementById('city'),
  notes:document.getElementById('notes'),
  agree:document.getElementById('agree'),
  form:document.getElementById('orderForm'),
  sendBtn:document.getElementById('sendBtn'),
  previewBtn:document.getElementById('previewBtn'),
  ctaTop:document.getElementById('ctaTop'),
  modal:document.getElementById('modal'),
  closeModal:document.getElementById('closeModal'),
  prevImg:document.getElementById('prevImg'),
  prevProd:document.getElementById('prevProd'),
  prevOpt:document.getElementById('prevOpt'),
  prevOptLine:document.getElementById('prevOptLine'),
  prevPrice:document.getElementById('prevPrice'),
  prevName:document.getElementById('prevName'),
  prevPhone:document.getElementById('prevPhone'),
  prevAddr:document.getElementById('prevAddr'),
  prevNotesWrap:document.getElementById('prevNotesWrap'),
  prevNotes:document.getElementById('prevNotes'),
  sendFromPreview:document.getElementById('sendFromPreview'),
  downloadPromo:document.getElementById('downloadPromo'),
  // i18n labels:
  t:{ title:document.getElementById('t_title'), details:document.getElementById('t_details'), option:document.getElementById('t_option'),
      choose:document.getElementById('t_choose'),
      name:document.getElementById('t_name'), phone:document.getElementById('t_phone'), city:document.getElementById('t_city'),
      notes:document.getElementById('t_notes'), confirm:document.getElementById('t_confirm'), send:document.getElementById('t_send'),
      preview:document.getElementById('t_preview'), orderNow:document.getElementById('t_orderNow'), previewTitle:document.getElementById('t_previewTitle'),
      prevProd:document.getElementById('t_prevProd'), prevOpt:document.getElementById('t_prevOpt'), prevPrice:document.getElementById('t_prevPrice'),
      prevName:document.getElementById('t_prevName'), prevPhone:document.getElementById('t_prevPhone'), prevAddr:document.getElementById('t_prevAddr'),
      prevNotes:document.getElementById('t_prevNotes'), sendNow:document.getElementById('t_sendNow'), download:document.getElementById('t_download')}
};

function i18n(){
  const S=STR[LANG];
  document.documentElement.lang = LANG==='he'?'he':'ar';
  document.documentElement.dir  = 'rtl';
  els.t.title.textContent=S.title;
  els.t.details.textContent=S.details;
  els.t.option.textContent=S.option;
  els.t.choose.textContent=S.choose;
  els.t.name.textContent=S.name;
  els.t.phone.textContent=S.phone;
  els.t.city.textContent=S.city;
  els.t.notes.textContent=S.notes;
  els.t.confirm.textContent=S.confirm;
  els.t.send.textContent=S.send;
  els.t.preview.textContent=S.preview;
  els.t.orderNow.textContent=S.orderNow;
  els.t.previewTitle.textContent=S.previewTitle;
  els.t.prevProd.textContent=S.prevProd;
  els.t.prevOpt.textContent=S.prevOpt;
  els.t.prevPrice.textContent=S.prevPrice;
  els.t.prevName.textContent=S.prevName;
  els.t.prevPhone.textContent=S.prevPhone;
  els.t.prevAddr.textContent=S.prevAddr;
  els.t.prevNotes.textContent=S.prevNotes;
  els.t.sendNow.textContent=S.sendNow;
  els.t.download.textContent=S.download;
}

function normalizeILPhone(input){
  const d=(input||"").replace(/\D+/g,"");
  if(!d) return "";
  if(d.startsWith("972")){
    const local=d.slice(3);
    return local.startsWith("0")?local:"0"+local;
  }
  if(d.startsWith("05")) return d;
  if(d.startsWith("5")) return "0"+d;
  return d;
}
function toIntlNoPlus(local05){
  const d=(local05||"").replace(/\D+/g,"");
  if(!d) return "";
  if(d.startsWith("972")) return d;
  const with0=d.startsWith("0")?d.slice(1):d;
  return "972"+with0;
}

function buildText({prod,opt,name,phone,city,notes}){
  const S=STR[LANG];
  return (
   `ğŸ§¾ MAD Perfumeur â€” ${LANG==='he'?'×”×–×× ×” ×—×“×©×”':'Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯'}\n\n`+
   `${S.prevProd} ${prod.name} (${prod.id})\n`+
   (opt?`${S.prevOpt} ${opt}\n`:"")+
   `${S.prevPrice} â‚ª${prod.price}\n\n`+
   `${S.prevName} ${name}\n`+
   `${S.prevPhone} ${phone}\n`+
   `${S.prevAddr} ${city}\n`+
   (notes?`${S.prevNotes} ${notes}\n\n`:"\n")+
   `${LANG==='he'?'×× ×™ ×××©×¨/×ª ×‘×™×¦×•×¢ ×”×–×× ×” ×œ×¤×™ ×”×¤×¨×˜×™×.':'Ø£Ø¤ÙƒØ¯ ØªÙ†ÙÙŠØ° Ø§Ù„Ø·Ù„Ø¨ ÙˆÙÙ‚ Ø§Ù„ØªÙØ§ØµÙŠÙ„.'}`
  );
}

async function fetchImageAsFile(url, name="promo.png"){
  const r=await fetch(url,{mode:"cors"});
  const b=await r.blob();
  return new File([b], name, {type:b.type || "image/png"});
}

/*** Render selected + carousel ***/
let selected = PRODUCTS[0];
function renderSelected(){
  els.hero.src = selected.img;
  els.selName.textContent = `${selected.name} (${selected.id})`;
  els.selPrice.textContent = 'â‚ª'+selected.price;

  // non-ml options only
  const nonMl = (selected.options||[]).filter(x=>!/\b\d+\s*ml\b/i.test(x)&&!/ml/i.test(x));
  els.option.innerHTML="";
  if(nonMl.length){
    els.optionWrap.classList.remove('hidden');
    const emptyOpt=document.createElement('option'); emptyOpt.value=""; emptyOpt.textContent=LANG==='he'?'â€” ×œ×œ× ×‘×—×™×¨×” â€”':'â€” Ø¨Ø¯ÙˆÙ† Ø§Ø®ØªÙŠØ§Ø± â€”';
    els.option.appendChild(emptyOpt);
    nonMl.forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; els.option.appendChild(o); });
  }else{
    els.optionWrap.classList.add('hidden');
  }
}

function renderCarousel(){
  els.carousel.innerHTML="";
  PRODUCTS.forEach((p,idx)=>{
    const btn=document.createElement('button');
    btn.className="snap-start shrink-0 w-40 rounded-2xl p-2 bg-slate-900 border transition border-slate-800";
    btn.innerHTML = `
      <div class="relative aspect-square overflow-hidden rounded-xl bg-slate-800">
        <img src="${p.img}" alt="" class="h-full w-full object-contain bg-black/20">
      </div>
    `;
    btn.addEventListener('click', ()=>{
      selected = p;
      renderSelected();
      document.getElementById('app').scrollTo({top:0,behavior:'smooth'});
    });
    if(idx===0) btn.classList.add("border-amber-500","shadow-lg");
    els.carousel.appendChild(btn);
  });
}

/*** Preview + send (promo image attach) ***/
function fillPreview(){
  const opt = els.option.value || "";
  els.prevImg.src = selected.img;
  els.prevProd.textContent = `${selected.name} (${selected.id})`;
  if(opt){ els.prevOptLine.classList.remove('hidden'); els.prevOpt.textContent = opt; }
  else   { els.prevOptLine.classList.add('hidden');  els.prevOpt.textContent = "â€”"; }
  els.prevPrice.textContent = 'â‚ª'+selected.price;
  const norm = normalizeILPhone(els.phone.value);
  els.prevName.textContent  = els.name.value || 'â€”';
  els.prevPhone.textContent = norm || 'â€”';
  els.prevAddr.textContent  = els.city.value || 'â€”';
  const n=(els.notes.value||"").trim();
  if(n){ els.prevNotesWrap.classList.remove('hidden'); els.prevNotes.textContent=n; }
  else { els.prevNotesWrap.classList.add('hidden'); els.prevNotes.textContent=""; }
}

async function doSend(){
  if(!els.agree.checked){ alert(LANG==='he'?'×™×© ×œ××©×¨ ××ª ×”×ª× ××™× ×œ×¤× ×™ ×©×œ×™×—×”':'ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.'); return; }
  const norm = normalizeILPhone(els.phone.value);
  const intl = toIntlNoPlus(norm);
  const text = buildText({
    prod:selected, opt:els.option.value||"",
    name:els.name.value, phone:norm, city:els.city.value,
    notes:(els.notes.value||"").trim()
  });

  let shareFile=null;
  try{ shareFile = await fetchImageAsFile(selected.img, `${selected.id}.png`); }catch(e){}

  try{
    const data = shareFile? {files:[shareFile], text, title:'MAD Order'} : {text, title:'MAD Order'};
    if(navigator.canShare && navigator.canShare(data)){
      await navigator.share(data);
      return;
    }
  }catch(e){}

  window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`,"_blank");
  fillPreview();
  els.downloadPromo.classList.remove('hidden');
  els.downloadPromo.href = selected.img;
  els.modal.classList.remove('hidden'); els.modal.classList.add('flex');
}

/*** About BNG auto-detect (any ext/case/spacing) ***/
function canLoad(src){
  return new Promise(res=>{
    const im=new Image();
    im.onload=()=>res(true);
    im.onerror=()=>res(false);
    im.src = src + (src.includes('?')?'&':'?') + 'v=' + Date.now();
  });
}
async function setAboutAuto(){
  const bases = [
    'About BNG','ABOUT BNG','about bng',
    'About_BNG','ABOUT_BNG','about_bng',
    'About-BNG','ABOUT-BNG','about-bng'
  ];
  const exts = ['.png','.jpg','.jpeg','.webp','.gif','.PNG','.JPG','.JPEG','.WEBP','.GIF'];
  for(const b of bases){
    const enc = b.replace(/\s/g,'%20');
    for(const e of exts){
      const p = `img/${enc}${e}`;
      if(await canLoad(p)){ document.getElementById('aboutImg').src = p; return; }
    }
  }
  // Ù„Ù… ØªÙØ¹Ø«Ø± ØµÙˆØ±Ø©Ø› Ø§ØªØ±ÙƒÙ‡Ø§ ÙØ§Ø±ØºØ© Ø£Ùˆ Ø¹ÙŠÙ‘Ù† ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ù† Ø£Ø±Ø¯Øª
}

/*** Events ***/
document.getElementById('ctaTop').onclick = (e)=>{e.preventDefault(); document.getElementById('app').scrollTo({top:0,behavior:'smooth'});}
document.getElementById('previewBtn').onclick = ()=>{ fillPreview(); els.modal.classList.remove('hidden'); els.modal.classList.add('flex'); };
document.getElementById('closeModal').onclick = ()=>{ els.modal.classList.add('hidden'); els.modal.classList.remove('flex'); };
document.getElementById('sendFromPreview').onclick = doSend;
document.getElementById('orderForm').addEventListener('submit', (e)=>{ e.preventDefault(); doSend(); });

/*** INIT ***/
(function init() {
  // WA override via ?wa=
  const qs = new URLSearchParams(location.search);
  const wa = (qs.get('wa')||'').replace(/\D+/g,'');
  if(wa) WHATSAPP_NUMBER = wa;
  els.callWa.href = "https://wa.me/"+WHATSAPP_NUMBER;

  // Language + UI
  LANG = detectLang(); i18n();

  // Render
  renderCarousel();
  selected = PRODUCTS[0];
  renderSelected();

  // About BNG auto
  setAboutAuto();
})();
</script>
</body>
</html>
